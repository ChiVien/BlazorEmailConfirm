@page "/thisinh"
@page "/thisinh/{id:int}"
@using Microsoft.AspNetCore.Authorization;
@using Microsoft.AspNetCore.Identity;
@using Microsoft.AspNetCore.Components.Authorization
@using Microsoft.AspNetCore.Components.WebAssembly.Authentication
@inject ISinhvientrungtuyen Sinhvientrungtuyen
@inject NavigationManager NavigationManager
@inject ISnackbar Snackbar
@using System.ComponentModel.DataAnnotations

@*<EditForm Model="@model" OnValidSubmit="OnValidSubmit">
<DataAnnotationsValidator/>
	<MudCard>
		<MudCardContent>
			<MudGrid>
				<MudItem xs="6">
					<MudTextField Label="First name" HelperText="Max. 8 characters" @bind-Value="model.Username" For="@(() => model.Username)"/>
				</MudItem>
				<MudItem xs="6">
					<MudTextField Label="Password" HelperText="Choose a strong password" @bind-Value="model.Password" For="@(() => model.Password)" InputType="InputType.Password"/>
				</MudItem>
				<MudItem xs="12">
					<MudDatePicker Label="Editable with Placeholder" Editable="true" @bind-Date="model.datetime" Placeholder="Select Date" For="@(()=>model.datetime)"/>
				</MudItem>
				<MudItem xs="6">
					<MudSelect Label="Loai" @bind-Value="model.nganh" AnchorOrigin="Origin.BottomCenter">
						@foreach(var nganh in Nganhs)
						{
							<MudSelectItem Value="nganh">@nganh</MudSelectItem>
						}
					</MudSelect>
				</MudItem>
			</MudGrid>
		</MudCardContent>
	</MudCard>
	<MudCardActions>
		<MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Primary" Class="ml-auto">Register</MudButton>
	</MudCardActions>
</EditForm>*@

@if (Id == null)
{
	<PageTitle >NHẬP HỒ SƠ ĐĂNG KÝ XÉT TUYỂN TRỰC TUYẾN</PageTitle>
	<h3 class="text-center">NHẬP HỒ SƠ ĐĂNG KÝ XÉT TUYỂN TRỰC TUYẾN</h3>
	<h4 class="text-center">(Dành cho thí sinh đã tốt nghiệp THCS/THPT)</h4>
}
else
{
	<PageTitle>Chỉnh sửa @thish.HoTen</PageTitle>
	<h3 class="text-center">CHỈNH SỬA HỒ SƠ THÍ SINH @thish.HoTen</h3>
	<h4 class="text-center">(Dành cho thí sinh đã tốt nghiệp THCS/THPT)</h4>
}

<EditForm Model="thish" OnSubmit="HandleSubmit">
@switch (test)
{
	case 1:
		<div class="row">
			<div class="col-md-2">
				<label for="inputEmail3" class="form-label">HK1:(*)</label>
				<InputText id="cmnd" @bind-Value="thish.HoTen" class="form-control"></InputText>
			</div>
			<div class="col-md-2">
				<label for="inputEmail3" class="form-label">Hk2:(*)</label>
				<InputText id="cmnd" @bind-Value="thish.HoTen" class="form-control"></InputText>
			</div>
		</div>
		<div class="row">
			<div class="col-md-2">
				<label for="inputEmail3" class="form-label">HK1:(*)</label>
				<InputText id="cmnd" @bind-Value="thish.HoTen" class="form-control"></InputText>
			</div>
			<div class="col-md-2">
				<label for="inputEmail3" class="form-label">Hk2:(*)</label>
				<InputText id="cmnd" @bind-Value="thish.HoTen" class="form-control"></InputText>
			</div>
		</div>
		<div class="row">
			<div class="col-md-2">
				<label for="inputEmail3" class="form-label">HK1:(*)</label>
				<InputText id="cmnd" @bind-Value="thish.HoTen" class="form-control"></InputText>
			</div>
			<div class="col-md-2">
				<label for="inputEmail3" class="form-label">Hk2:(*)</label>
				<InputText id="cmnd" @bind-Value="thish.HoTen" class="form-control"></InputText>
			</div>
		</div>
		break;
	case 2:
		<div class="row">
			<div class="col-md-2">
				<label for="inputEmail3" class="form-label">HK1:(*)</label>
				<InputText id="cmnd" @bind-Value="thish.HoTen" class="form-control"></InputText>
			</div>
			<div class="col-md-2">
				<label for="inputEmail3" class="form-label">Hk2:(*)</label>
				<InputText id="cmnd" @bind-Value="thish.HoTen" class="form-control"></InputText>
			</div>
			<div class="col-md-2">
				<label for="inputEmail3" class="form-label">TB:(*)</label>
				<InputText id="cmnd" @bind-Value="thish.HoTen" class="form-control"></InputText>
			</div>
		</div>
		<div class="row">
			<div class="col-md-2">
				<label for="inputEmail3" class="form-label">HK1:(*)</label>
				<InputText id="cmnd" @bind-Value="thish.HoTen" class="form-control"></InputText>
			</div>
			<div class="col-md-2">
				<label for="inputEmail3" class="form-label">Hk2:(*)</label>
				<InputText id="cmnd" @bind-Value="thish.HoTen" class="form-control"></InputText>
			</div>
			<div class="col-md-2">
				<label for="inputEmail3" class="form-label">TB:(*)</label>
				<InputText id="cmnd" @bind-Value="thish.HoTen" class="form-control"></InputText>
			</div>
		</div>
		<div class="row">
			<div class="col-md-2">
				<label for="inputEmail3" class="form-label">HK1:(*)</label>
				<InputText id="cmnd" @bind-Value="thish.HoTen" class="form-control"></InputText>
			</div>
			<div class="col-md-2">
				<label for="inputEmail3" class="form-label">Hk2:(*)</label>
				<InputText id="cmnd" @bind-Value="thish.HoTen" class="form-control"></InputText>
			</div>
			<div class="col-md-2">
				<label for="inputEmail3" class="form-label">TB:(*)</label>
				<InputText id="cmnd"@bind-Value="thish.HoTen" class="form-control"></InputText>
			</div>
		</div>
		break;
	case 3:
		<div class="row">
			<div class="col-md-2">
				<label for="inputEmail3" class="form-label">HK1:(*)</label>
				<InputText id="cmnd" @bind-Value="thish.HoTen"class="form-control"></InputText>
			</div>
		</div>
		<div class="row">
			<div class="col-md-2">
				<label for="inputEmail3" class="form-label">HK1:(*)</label>
				<InputText id="cmnd"@bind-Value="thish.HoTen" class="form-control"></InputText>
			</div>
		</div>
		<div class="row">
			<div class="col-md-2">
				<label for="inputEmail3" class="form-label">HK1:(*)</label>
				<InputText id="cmnd"@bind-Value="thish.HoTen" class="form-control"></InputText>
			</div>
		</div>
		break;
	default:
		break;
}
</EditForm>

<EditForm Model="thish" OnSubmit="HandleSubmit">
	<InputSelect id="manganhxettuyen" @bind-Value="test" class="form-select">
		<option selected value=1>Xet 2 HK lop 12</option>
		<option value=2>Xét 2 HK lớp 11 và HK 1 lớp 12</option>
		<option value=3>Xét điểm trung bình cả năm lớp 12 của tổ hợp 3 môn</option>
	</InputSelect>
	<form class="row g-3">
		@*Thông tin cá nhân*@
		<h6>1.Thông Tin Thí Sinh:</h6>
		<div class="col-md-1"></div>
		<div class="col-md-8">
			<label for="inputEmail3" class="form-label">Họ và tên: (*)</label>
				<InputText id="hoten" @bind-Value="thish.HoTen" class="form-control"></InputText>
		</div>
		<div class="col-md-3"></div>
		@*Infor*@
		<div class="col-md-1"></div>
		<div class="col-md-2">
			<label for="gioitinh" class="form-label">Giới Tính:</label>
				<InputSelect id="gioitinh" @bind-Value="thish.GioiTinh" class="form-select">
					<option selected>Chọn</option>
					<option>Nam</option>
					<option>Nữ</option>
				</InputSelect>
		</div>
		<div class="col-md-2">
			<label for="inputEmail3" class="form-label">Ngày sinh: (dd/mm/yyyy) (*)</label>
				<InputText id="ngaysinh" @bind-Value="thish.NgaySinh" class="form-control"></InputText>
		</div>
		<div class="col-md-2">
			<label for="sdt" class="form-label">Số Điện Thoại:</label>
			<InputText id="sdt" @bind-Value="thish.Sdt" class="form-control"></InputText>
		</div>
		<div class="col-md-2">
			<label for="inputEmail3" class="form-label">CMND:(*)</label>
				<InputText id="cmnd" @bind-Value="thish.Cmnd" class="form-control"></InputText>
		</div>
		<div class="col-md-3"></div>
		@*Infor2*@
		<div class="col-md-1"></div>
		<div class="col-md-5">
			<label for="diachi" class="form-label">Địa Chỉ:</label>
			<InputText id="diachi" @bind-Value="thish.Diachi" class="form-control"></InputText>
		</div>
		<div class="col-md-3">
			<label for="email" class="form-label">Email:</label>
			<InputText id="email" @bind-Value="thish.Email" class="form-control"></InputText>
		</div>
		@*Ngành học*@
		<h6>2.Xét Tuyển:</h6>
		<div class="col-md-1"></div>
		<div class="col-md-8">
			<label for="inputEmail3" class="form-label">Đăng ký bậc học: (*)</label>
				<InputSelect id="Bachoc" @bind-Value="thish.BacHoc" class="form-select">
					<option selected>Chọn</option>
					<option>Hệ Đại Học (Liên kết đào tạo từ xa Đại Học Cần Thơ</option>
					<option>Cao đẳng chính quy</option>
					<option>Đại Học (Liên kết đào tạo Đại Học Mở TP.HCM)</option>
					<option>Đại Học (Liên kết đào tạo Đại Học GTVT TP.HCM)</option>
					<option>Đại Học (Liên kết đào tạo Đại Học Sư Phạm Kỹ Thuật TP.HCM)</option>
					<option>Cao Đẳng Nghề</option>
					<option>Trung cấp nghề nghiệp</option>
					<option>Du Học Mỹ</option>
					<option>Du Học Philippines</option>
					<option>Tu nghiệp sinh Nhật Bản</option>
					<option>Tu nghiệp sinh Đức</option>
					<option>Du Học Hàn Quốc</option>
					<option>Đại Học (Liên kết đào tạo Đại Học Kinh Tế TP.HCM)</option>
				</InputSelect>
		</div>
		<div class="col-md-3"></div>
		@*-----*@
		<div class="col-md-1"></div>
		<div class="col-md-4">
			<label for="inputEmail3" class="form-label">Ngành học:(*)</label>
				<InputSelect id="manganhxettuyen" @bind-Value="thish.MaNganhXetTuyen" class="form-select">
					<option selected>Chọn</option>
					<option>Công nghệ kỹ thuật cơ khí</option>
					<option>CNKT Ô tô (Quản trị vận tải Ô tô)</option>
					<option>Công Nghệ Kỹ Thuật Điện - Điện tử</option>
					<option>Quản trị kinh doanh (QT Marketing)</option>
					<option>Quản trị Nhà hàng - Khách sạn</option>
					<option>Tin học ứng dụng (Lập trình ứng dụng)</option>
					<option>Tin học ứng dụng (Công nghệ phần mềm)</option>
					<option>Tin học ứng dụng (Lập trình Game)</option>
					<option>Thiết kế đồ họa</option>
					<option>Mạng máy tính</option>
				</InputSelect>
		</div>
		<div class="col-md-4">
			<label for="khoixettuyen" class="form-label">Khối Xét Tuyển: (*)</label>
				<InputSelect id="khoixettuyen" @bind-Value="thish.KhoiXetTuyen" class="form-select">
					<option value="">Chọn</option>
					<option value="A00">A00-Toán-Lý-Hóa</option>
					<option value="A01">A01-Toán-Lý-Anh</option>
					<option value="C01">C01-Toán-Văn-Lý</option>
					<option value="D01">D01-Toán-Văn-Anh</option>
					<option value="TH1">TH1-Toán-Lý-Công nghệ</option>
					<option value="TH2">TH2-Toán-Văn-Tin</option>
				</InputSelect>
		</div>
		<div class="col-md-3"></div>
		@*----*@
		<div class="col-md-1"></div>
		<div class="col-md-2">
			<label for="inputEmail3" class="form-label">Đối tượng ưu tiên:</label>
				<InputSelect id="doituong" @bind-Value="thish.DoiTuong" class="form-select">
					<option value="">Chọn</option>
					<option value="01">01</option>
					<option value="02">02</option>
					<option value="03">03</option>
					<option value="04">04</option>
					<option value="05">05</option>
					<option value="06">06</option>
					<option value="07">07</option>
				</InputSelect>
		</div>
		<div class="col-md-2">
			<label for="khuvuc"  class="form-label">Khu Vực:</label>
				<InputSelect id="khuvuc" @bind-Value="thish.KhuVuc" class="form-select">
					<option value="">Chọn</option>
					<option value="KV2NT">KV2NT</option>
					<option value="KV1">KV1</option>
					<option value="KV2">KV2</option>
					<option value="KV3">KV3</option>
				</InputSelect>
		</div>
		@*Score*@
		<div class="col-md-2">
			<label for="diemuutiendt" class="form-label">Điểm Ưu Tiên DT:</label>
				<InputNumber id="diemuutiendt" @bind-Value="thish.DiemUuTienDT" class="form-control"></InputNumber>
		</div>
		<div class="col-md-2">
			<label for="diemuutienkv" class="form-label">Điểm Ưu Tiên KV:</label>
			<InputNumber id="diemuutienkv" @bind-Value="thish.DiemUuTienKV" class="form-control"></InputNumber>
		</div>
		
		<div class="col-md-3"></div>
		@*----*@
		<h6>3.Xét Tuyển theo kỳ thi THPT Quốc Gia:</h6>
		<div class="col-md-1"></div>
		<div class="col-md-2">
			<label for="mon1" class="form-label">Môn 1:</label>
			<InputText id="mon1" @bind-Value="thish.Mon1" class="form-control"></InputText>
		</div>
		<div class="col-md-2">
			<label for="mon2" class="form-label">Môn 2:</label>
			<InputText id="mon2" @bind-Value="thish.Mon2" class="form-control"></InputText>
		</div>
		<div class="col-md-2">
			<label for="mon3" class="form-label">Môn 3:</label>
			<InputText id="mon3" @bind-Value="thish.Mon3" class="form-control"></InputText>
		</div>
		<div class="col-md-5"></div>
		@*----*@
		<div class="col-md-1"></div>
		<div class="col-md-1">
			<label for="diem1111" class="form-label">Điểm1111:</label>
			<InputNumber id="diem1111" @bind-Value="thish.Diem1111" class="form-control"></InputNumber>
		</div>
		<div class="col-md-1">
			<label for="diem1211" class="form-label">Điểm1211:</label>
			<InputNumber id="diem1211" @bind-Value="thish.Diem1211" class="form-control"></InputNumber>
		</div>
		<div class="col-md-1">
			<label for="diem1112" class="form-label">Điểm1112:</label>
			<InputNumber id="diem1112" @bind-Value="thish.Diem1112" class="form-control"></InputNumber>
		</div>
		<div class="col-md-1">
			<label for="diem1212" class="form-label">Điểm1212:</label>
			<InputNumber id="diem1212" @bind-Value="thish.Diem1212" class="form-control"></InputNumber>
		</div>
		<div class="col-md-1">
			<label for="diem1TB12" class="form-label">Điểm1TB12:</label>
			<InputNumber id="diem1TB12" @bind-Value="thish.Diem1TB12" class="form-control"></InputNumber>
		</div>
		<div class="col-md-6"></div>
		@*----*@
		<div class="col-md-1"></div>
		<div class="col-md-1">
			<label for="diem2111" class="form-label">Điểm2111:</label>
			<InputNumber id="diem2111" @bind-Value="thish.Diem2111" class="form-control"></InputNumber>
		</div>
		<div class="col-md-1">
			<label for="diem2211" class="form-label">Điểm2211:</label>
			<InputNumber id="diem2211" @bind-Value="thish.Diem2211" class="form-control"></InputNumber>
		</div>
		<div class="col-md-1">
			<label for="diem2112" class="form-label">Điểm2112:</label>
			<InputNumber id="diem2112" @bind-Value="thish.Diem2112" class="form-control"></InputNumber>
		</div>
		<div class="col-md-1">
			<label for="diem2212" class="form-label">Điểm2212:</label>
			<InputNumber id="diem2212" @bind-Value="thish.Diem2212" class="form-control"></InputNumber>
		</div>
		<div class="col-md-1">
			<label for="diem2TB12" class="form-label">Điểm2TB12:</label>
			<InputNumber id="diem2TB12" @bind-Value="thish.Diem2TB12" class="form-control"></InputNumber>
		</div>
		<div class="col-md-6"></div>
		@*----*@
		<div class="col-md-1"></div>
		<div class="col-md-1">
			<label for="diem3111" class="form-label">Điểm3111:</label>
			<InputNumber id="diem3111" @bind-Value="thish.Diem3111" class="form-control"></InputNumber>
		</div>
		<div class="col-md-1">
			<label for="diem3211" class="form-label">Điểm3211:</label>
			<InputNumber id="diem3211" @bind-Value="thish.Diem3211" class="form-control"></InputNumber>
		</div>
		<div class="col-md-1">
			<label for="diem3112" class="form-label">Điểm3112:</label>
			<InputNumber id="diem3112" @bind-Value="thish.Diem3112" class="form-control"></InputNumber>
		</div>
		<div class="col-md-1">
			<label for="diem3212" class="form-label">Diem3212:</label>
			<InputNumber id="Diem3212" @bind-Value="thish.Diem3212" class="form-control"></InputNumber>
		</div>
		<div class="col-md-1">
			<label for="diem3TB12" class="form-label">Điểm3TB12:</label>
			<InputNumber id="diem3TB12" @bind-Value="thish.Diem3TB12" class="form-control"></InputNumber>
		</div>
		<div class="col-md-6"></div>
		@*----*@
		<h6>4.Xét tuyển từ kết quả học bạ THPT/THBT:</h6>
		<div class="col-md-1"></div>
		<div class="col-md-6">
			<label for="truongTHPT" class="form-label">Trường THPT:</label>
			<InputText id="truongTHPT" @bind-Value="thish.TruongTHPT" class="form-control"></InputText>
		</div>
		<div class="col-md-5"></div>
		<div class="col-md-1"></div>
		<div class="col-md-3">
			<label for="hK11" class="form-label">HK11:</label>
			<InputText id="hK11" @bind-Value="thish.HK11" class="form-control"></InputText>
		</div>
		<div class="col-md-3">
			<label for="hK12" class="form-label">HK12:</label>
			<InputText id="hK12" @bind-Value="thish.HK12" class="form-control"></InputText>
		</div>
		<div class="col-md-5"></div>
		<div class="col-md-1"></div>
		<div class="col-md-2">
			<label for="diem1" class="form-label">Điểm 1:</label>
			<InputNumber id="diem1" @bind-Value="thish.diem1" class="form-control"></InputNumber>
		</div>
		<div class="col-md-2">
			<label for="diem2" class="form-label">Điểm 2:</label>
			<InputNumber id="diem2" @bind-Value="thish.diem2" class="form-control"></InputNumber>
		</div>
		<div class="col-md-2">
			<label for="diem3" class="form-label">Điểm 3:</label>
			<InputNumber id="diem3" @bind-Value="thish.diem3" class="form-control"></InputNumber>
		</div>
		<div class="col-md-2">
			<label for="tong" class="form-label">Tổng:</label>
			<InputNumber id="tong" @bind-Value="thish.Tong" class="form-control"></InputNumber>
		</div>
		<div class="col-md-3"></div>
		<div class="col-md-1"></div>
		<div class="col-md-3">
			<label for="maDKXT" class="form-label">Mã ĐKXT:</label>
			<InputNumber id="maDKXT" @bind-Value="thish.MaDKXT" class="form-control"></InputNumber>
		</div>
		<div class="col-md-8"></div>
		<h6>5.Thông tin liên lạc:</h6>
		<div class="col-md-1"></div>
		<div class="col-md-3">
			<label for="canbotuvan" class="form-label">Cán bộ tư vấn:</label>
			<InputText id="canbotuvan" @bind-Value="thish.CBTuVan" class="form-control"></InputText>
		</div>
		<div class="col-md-1"></div>
		<div class="col-md-3">
			<label for="ngaygui" class="form-label">Ngày Gửi:</label>
			<InputDate id="ngaygui" @bind-Value="thish.Ngaygui" class="form-control" readonly="fase"></InputDate>
		</div>
	</form>
		<br />
		<div>
			<InputFile class="custom-file-input" id="fileInput" @bind-Value="thish.HinhAnhs" OnChange="OnFileChange"></InputFile>
		</div>
		@foreach (var img in listAnhUpload)
		{
			<div class="d-lg-table-cell">
				<div>
					<img class="img-thumbnail" id="fileInput" src="@img.anh" alt="Avatar">
				</div>
			</div>
		}	

		<br />
		<button type="submit" class="btn btn-outline-primary">@btnText</button>
		<button type="button" class="btn btn-outline-danger" @onclick="Deletethisinh">@btnDelete</button>
</EditForm>
@code {
	private bool arrows = true;
	private bool bullets = true;
	private bool autocycle = true;
	private int test = 1;
	private Transition transition = Transition.Slide;


	[Parameter]
	public int? Id { get; set; }

	string btnText = string.Empty;
	string btnDelete = string.Empty;

	ThiSinh thish = new ThiSinh();
	List<AnhUpload> listAnhUpload = new List<AnhUpload>(); 


	protected override async Task OnInitializedAsync()
	{
		btnText = Id == null ? "Lưu Sinh Vien" : "Cập Nhật Sinh Viên";
		btnDelete = Id == null ? "Cancel Thi Sinh" : "Delete Thi Sinh";
		await Sinhvientrungtuyen.Getthisinh();
	}
	protected override async Task OnParametersSetAsync()
	{
		if (Id == null)
		{
			//Create 
		}
		else
		{
			thish = await Sinhvientrungtuyen.GetSingleThisinh((int)Id);
			foreach (var item in thish.HinhAnhs)
			{
				listAnhUpload.Add(new AnhUpload(item.Image));
			}
		}
	}
	async Task HandleSubmit()
	{
		if (Id == null)
		{
			thish.TrangThai = "Pending";
			//thish.Ngaygui = DateTime.Now;
			//thish.CreateDateTime = DateTime.Now;
			//thish.UpdateDateTime = DateTime.Now;
			await Sinhvientrungtuyen.CreateThiSinh(thish,listAnhUpload);
		}
		else
		{
			await Sinhvientrungtuyen.UpdateThiSinh(thish,listAnhUpload);
		}
	}
	async Task Deletethisinh()
	{
		if (Id != null)
			await Sinhvientrungtuyen.DeleteThiSinh(thish.Id);
		NavigationManager.NavigateTo("/sinhvienss");
	}

	async Task OnFileChange(InputFileChangeEventArgs e)
	{
		var format = "image/png";
		var resizedimage = await e.File.RequestImageFileAsync(format, 200, 200);
		var buffer = new byte[resizedimage.Size];
		await resizedimage.OpenReadStream().ReadAsync(buffer);
		var imagedata = $"data:{format};base64,{Convert.ToBase64String(buffer)}";
		AnhUpload anhUpload = new AnhUpload();
		anhUpload.anh=imagedata;
		anhUpload.status = 0;
		listAnhUpload.Add(anhUpload);
	}


	//-----------------------------
	RegisterAccountForm model = new RegisterAccountForm();
	bool success;

	public class RegisterAccountForm
	{
		[Required]
		public string Username { get; set; }

		[Required]
		[StringLength(30, ErrorMessage = "Password must be at least 8 characters long.", MinimumLength = 8)]
		public string Password { get; set; }

		[Required]
		public DateTime? datetime { get; set; }

		public string nganh{ get; set; }

	}

	private void OnValidSubmit(EditContext context)
	{
		Console.WriteLine(model);
		success = true;
		StateHasChanged();
	}

	List<string> Nganhs = new List<string>
	{
		"Nganh 1","Nganh 2","Nganh 3","Nganh 4"
	};
}
