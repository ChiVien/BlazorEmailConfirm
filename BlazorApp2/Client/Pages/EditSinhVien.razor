@page "/thisinh"
@page "/thisinh/{id:int}"
@inject ISinhvientrungtuyen Sinhvientrungtuyen
@inject NavigationManager NavigationManager
@inject ISnackbar Snackbar
@using System.ComponentModel.DataAnnotations

@if (Id == null)
{
	<PageTitle>Thêm Sinh Viên</PageTitle>
	<h3>Thêm Sinh Viên</h3>
}
else
{
	<PageTitle>Chỉnh sửa @thish.HoTen</PageTitle>
	<h3>Chỉnh sửa @thish.HoTen</h3>
}


<EditForm Model="@model" OnValidSubmit="OnValidSubmit">
<DataAnnotationsValidator/>
	<MudCard>
		<MudCardContent>
			<MudGrid>
				<MudItem xs="6">
					<MudTextField Label="First name" HelperText="Max. 8 characters" @bind-Value="model.Username" For="@(() => model.Username)"/>
				</MudItem>
				<MudItem xs="6">
					<MudTextField Label="Password" HelperText="Choose a strong password" @bind-Value="model.Password" For="@(() => model.Password)" InputType="InputType.Password"/>
				</MudItem>
				<MudItem xs="12">
					<MudDatePicker Label="Editable with Placeholder" Editable="true" @bind-Date="model.datetime" Placeholder="Select Date" For="@(()=>model.datetime)"/>
				</MudItem>
				<MudItem xs="6">
					<MudSelect Label="Loai" @bind-Value="model.nganh" AnchorOrigin="Origin.BottomCenter">
						@foreach(var nganh in Nganhs)
						{
							<MudSelectItem Value="nganh">@nganh</MudSelectItem>
						}
					</MudSelect>
				</MudItem>
			</MudGrid>
		</MudCardContent>
	</MudCard>
	<MudCardActions>
		<MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Primary" Class="ml-auto">Register</MudButton>
	</MudCardActions>
</EditForm>

<EditForm Model="thish" OnSubmit="HandleSubmit">
	<form>
		<div class="row mb-3 g-3">
			<label for="inputEmail3" class="col-sm-2">Họ và tên của thí sinh: (*)</label>
			<div class="col-sm-3">
			  <InputText id="hoten" @bind-Value="thish.HoTen" class="form-control"></InputText>
			</div>
			<label for="inputEmail3" class="col-sm-1">CMDD (*)</label>
			 <div class="col-sm-3">
				 <InputText id="hoten" @bind-Value="thish.HoTen" class="form-control"></InputText>
			  </div>
		</div>

		<div class="row mb-3 g-3">
			<label for="inputEmail3" class="col-sm-2">Ngày sinh: (dd/mm/yyyy) (*)</label>
			<div class="col-sm-3">
				<InputText id="NgaySinh" @bind-Value="thish.NgaySinh" class="form-control"></InputText>
			</div>
			<label for="gioitinh" class="col-sm-1">Giới Tính:</label>
			<div class="col-sm-2">
				<InputText id="gioitinh" @bind-Value="thish.GioiTinh" class="form-control"></InputText>
			</div>
		</div>

		<div class="row mb-3 g-3">
			<label for="inputEmail3" class="col-sm-2">Đăng ký bậc học: (*)</label>
			<div class="col-sm-3">
			<InputText id="Bachoc" @bind-Value="thish.BacHoc" class="form-control"></InputText>
			</div>
		</div>

		<div class="row mb-3">
			<label for="inputEmail3" class="col-sm-2">Ngành học:(*)</label>
			<div class="col-sm-2">
			  <InputText id="manganhxettuyen" @bind-Value="thish.MaNganhXetTuyen" class="form-control"></InputText>
			</div>
			<label for="khoixettuyen" class="col-sm-1 row-cols-2">Khối Xét Tuyển: (*)</label>
			<div class="col-sm-2"> 
				<InputText id="khoixettuyen" @bind-Value="thish.KhoiXetTuyen" class="form-control"></InputText>
			</div>
		</div>

		<div class="row mb-3">
			<label for="inputEmail3" class="col-sm-2">Thuộc đối tượng ưu tiên:</label>
			<div class="col-sm-2">
			 <InputText id="doituong" @bind-Value="thish.DoiTuong" class="form-control"></InputText>
			</div>
			<label for="khuvuc"  class="col-sm-1">Khu Vực:</label>
			<div class="col-sm-2"> 
			<InputText id="khuvuc" @bind-Value="thish.KhuVuc" class="form-control"></InputText>
			</div>
		</div>

	</form>

		@*<div>
			<label for="canbotuvan">Cán bộ tư vấn</label>
			<InputText id="canbotuvan" @bind-Value="thish.CBTuVan" class="form-control"></InputText>
		</div>
		<div>
			<label for="cmnd">CMND/Thẻ Căn Cước</label>
			<InputText id="cmnd" @bind-Value="thish.Cmnd" class="form-control"></InputText>
		</div>
		
		<div>
			<label for="gioitinh">Giới Tính</label>
			<InputText id="gioitinh" @bind-Value="thish.GioiTinh" class="form-control"></InputText>
		</div>
		<div>
			<label for="diemuutiendt">Điểm Ưu Tiên DT</label>
			<InputNumber id="diemuutiendt" @bind-Value="thish.DiemUuTienDT" class="form-control"></InputNumber>
		</div>
		<div>
			<label for="khuvuc">Khu Vực</label>
			<InputText id="khuvuc" @bind-Value="thish.KhuVuc" class="form-control"></InputText>
		</div>
		<div>
			<label for="diemuutienkv">Điểm Ưu Tiên KV</label>
			<InputNumber id="diemuutienkv" @bind-Value="thish.DiemUuTienKV" class="form-control"></InputNumber>
		</div>
		<div>
			<label for="khoixettuyen">Khối Xét Tuyển</label>
			<InputText id="khoixettuyen" @bind-Value="thish.KhoiXetTuyen" class="form-control"></InputText>
		</div>
		<div>
			<label for="mon1">Môn 1</label>
			<InputText id="mon1" @bind-Value="thish.Mon1" class="form-control"></InputText>
		</div>
		<div>
			<label for="mon2">Môn 2</label>
			<InputText id="mon2" @bind-Value="thish.Mon2" class="form-control"></InputText>
		</div>
		<div>
			<label for="mon3">Môn 3</label>
			<InputText id="mon3" @bind-Value="thish.Mon3" class="form-control"></InputText>
		</div>
		<div>
			<label for="diem1111">Điểm1111</label>
			<InputNumber id="diem1111" @bind-Value="thish.Diem1111" class="form-control"></InputNumber>
		</div>
		<div>
			<label for="diem1211">Điểm1211</label>
		
			<InputNumber id="diem1211" @bind-Value="thish.Diem1211" class="form-control"></InputNumber>
		</div>
		<div>
			<label for="diem1112">Điểm1112</label>
			<InputNumber id="diem1112" @bind-Value="thish.Diem1112" class="form-control"></InputNumber>
		</div>
		<div>
			<label for="diem1212">Điểm1212</label>
			<InputNumber id="diem1212" @bind-Value="thish.Diem1212" class="form-control"></InputNumber>
		</div>
		<div>
			<label for="diem1TB12">Điểm1TB12</label>
			<InputNumber id="diem1TB12" @bind-Value="thish.Diem1TB12" class="form-control"></InputNumber>
		</div>
		<div>
			<label for="diem2111">Điểm2111</label>
			<InputNumber id="diem2111" @bind-Value="thish.Diem2111" class="form-control"></InputNumber>
		</div>
		<div>
			<label for="diem2211">Điểm2211</label>
			<InputNumber id="diem2211" @bind-Value="thish.Diem2211" class="form-control"></InputNumber>
		</div>
		<div>
			<label for="diem2112">Điểm2112</label>
			<InputNumber id="diem2112" @bind-Value="thish.Diem2112" class="form-control"></InputNumber>
		</div>
		<div>
			<label for="diem2212">Điểm2212</label>
			<InputNumber id="diem2212" @bind-Value="thish.Diem2212" class="form-control"></InputNumber>
		</div>
		<div>
			<label for="diem2TB12">Điểm2TB12</label>
			<InputNumber id="diem2TB12" @bind-Value="thish.Diem2TB12" class="form-control"></InputNumber>
		</div>
		<div>
			<label for="diem3111">Điểm3111</label>
			<InputNumber id="diem3111" @bind-Value="thish.Diem3111" class="form-control"></InputNumber>
		</div>
		<div>
			<label for="diem3211">Điểm3211</label>
			<InputNumber id="diem3211" @bind-Value="thish.Diem3211" class="form-control"></InputNumber>
		</div>
		<div>
			<label for="diem3112">Điểm3112</label>
			<InputNumber id="diem3112" @bind-Value="thish.Diem3112" class="form-control"></InputNumber>
		</div>
		<div>
			<label for="diem3TB12">Điểm3TB12</label>
			<InputNumber id="diem3TB12" @bind-Value="thish.Diem3TB12" class="form-control"></InputNumber>
		</div>
		<div>
			<label for="diemTBPT1">ĐiểmTBPT1</label>
			<InputNumber id="diemTBPT1" @bind-Value="thish.DiemTBPT1" class="form-control"></InputNumber>
		</div>
		<div>
			<label for="diemTBPT2">ĐiểmTBPT2</label>
			<InputNumber id="diemTBPT2" @bind-Value="thish.DiemTBPT2" class="form-control"></InputNumber>
		</div>
		<div>
			<label for="diemTBPT3">ĐiểmTBPT3</label>
			<InputNumber id="diemTBPT3" @bind-Value="thish.DiemTBPT3" class="form-control"></InputNumber>
		</div>
		<div>
			<label for="truongTHPT">Trường THPT</label>
			<InputText id="truongTHPT" @bind-Value="thish.TruongTHPT" class="form-control"></InputText>
		</div>
		<div>
			<label for="hK11">HK11</label>
			<InputText id="hK11" @bind-Value="thish.HK11" class="form-control"></InputText>
		</div>
		<div>
			<label for="hK12">HK12</label>
			<InputText id="hK12" @bind-Value="thish.HK12" class="form-control"></InputText>
		</div>
		<div>
			<label for="maDKXT">Mã DKXT</label>
			<InputNumber id="maDKXT" @bind-Value="thish.MaDKXT" class="form-control"></InputNumber>
		</div>
		<div>
			<label for="diem1">Điểm 1</label>
			<InputNumber id="diem1" @bind-Value="thish.diem1" class="form-control"></InputNumber>
		</div>
		<div>
			<label for="diem2">Điểm 2</label>
			<InputNumber id="diem2" @bind-Value="thish.diem2" class="form-control"></InputNumber>
		</div>
		<div>
			<label for="diem3">Điểm 3</label>
			<InputNumber id="diem3" @bind-Value="thish.diem3" class="form-control"></InputNumber>
		</div>
		<div>
			<label for="tong">Tổng</label>
			<InputNumber id="tong" @bind-Value="thish.Tong" class="form-control"></InputNumber>
		</div>
		<div>
			<label for="sdt">Số Điện Thoại</label>
			<InputText id="sdt" @bind-Value="thish.Sdt" class="form-control"></InputText>
		</div>
		<div>
			<label for="email">Email</label>
			<InputText id="email" @bind-Value="thish.Email" class="form-control"></InputText>
		</div>
		<div>
			<label for="diachi">Địa Chỉ</label>
			<InputText id="diachi" @bind-Value="thish.Diachi" class="form-control"></InputText>
		</div>
		<div>
			<label for="ngaygui">Ngày Gửi</label>
			<InputDate id="ngaygui" @bind-Value="thish.Ngaygui" class="form-control" readonly="fase"></InputDate>
		</div>*@
		<br />
		 <InputFile id="fileInput" @bind-Value="thish.HinhAnhs" OnChange="OnFileChange" ></InputFile>

		<MudCarousel Class="mud-width-body" Style="height:300px;" ShowArrows="@arrows" ShowBullets="@bullets"  TData="object">
			@foreach(var img in thish.HinhAnhs){ 
				<MudCarouselItem Transition="transition" Color="@Color.Primary">
					<img src="https://localhost:7279/uploads/@img.Image" alt="ccgido" style="width:100%; height: auto"/>
				</MudCarouselItem>
			}
		</MudCarousel>
		<MudButton Class="ma-2" Variant="Variant.Filled" Color="Color.Error">Delete</MudButton>
		
		
		
	
		<br />
		<button type="submit" class="btn btn-outline-primary">@btnText</button>
		<button type="button" class="btn btn-outline-danger" @onclick="Deletethisinh">@btnDelete</button>
</EditForm>
@code {
	private bool arrows = true;
	private bool bullets = true;
	private bool autocycle = true;
	private Transition transition = Transition.Slide;


	[Parameter]
	public int? Id { get; set; }

	string btnText = string.Empty;
	string btnDelete = string.Empty;

	ThiSinh thish = new ThiSinh();
	List<AnhUpload> listAnhUpload = new List<AnhUpload>(); 


	protected override async Task OnInitializedAsync()
	{
		btnText = Id == null ? "Lưu Sinh Vien" : "Cập Nhật Sinh Viên";
		btnDelete = Id == null ? "Cancel Thi Sinh" : "Delete Thi Sinh";
		await Sinhvientrungtuyen.Getthisinh();
	}
	protected override async Task OnParametersSetAsync()
	{
		if (Id == null)
		{
			//Create 
		}
		else
		{
			thish = await Sinhvientrungtuyen.GetSingleThisinh((int)Id);
		}
	}
	async Task HandleSubmit()
	{
		if (Id == null)
		{
			thish.TrangThai = "Pending";
			//thish.Ngaygui = DateTime.Now;
			//thish.CreateDateTime = DateTime.Now;
			//thish.UpdateDateTime = DateTime.Now;
			await Sinhvientrungtuyen.CreateThiSinh(thish,listAnhUpload);
		}
		else
		{
			if (thish.HinhAnhs.Count > 0)
			{
				foreach(var img in thish.HinhAnhs)
				{
					AnhUpload anhUpload = new AnhUpload();
					anhUpload.anh=img.Image;
					anhUpload.status = 1;
					listAnhUpload.Add(anhUpload);
				}
			}
			await Sinhvientrungtuyen.UpdateThiSinh(thish,listAnhUpload);
		}
	}
	async Task Deletethisinh()
	{
		if (Id != null)
			await Sinhvientrungtuyen.DeleteThiSinh(thish.Id);
		NavigationManager.NavigateTo("/sinhvienss");
	}

	async Task OnFileChange(InputFileChangeEventArgs e)
	{
		var format = "image/png";
		var resizedimage = await e.File.RequestImageFileAsync(format, 200, 200);
		var buffer = new byte[resizedimage.Size];
		await resizedimage.OpenReadStream().ReadAsync(buffer);
		var imagedata = $"data:{format};base64,{Convert.ToBase64String(buffer)}";
		AnhUpload anhUpload = new AnhUpload();
		anhUpload.anh=imagedata;
		anhUpload.status = 0;
		listAnhUpload.Add(anhUpload);

	}


	//-----------------------------
	RegisterAccountForm model = new RegisterAccountForm();
	bool success;

	public class RegisterAccountForm
	{
		[Required]
		public string Username { get; set; }

		[Required]
		[StringLength(30, ErrorMessage = "Password must be at least 8 characters long.", MinimumLength = 8)]
		public string Password { get; set; }

		[Required]
		public DateTime? datetime { get; set; }

		public string nganh{ get; set; }

	}

	private void OnValidSubmit(EditContext context)
	{
		Console.WriteLine(model);
		success = true;
		StateHasChanged();
	}

	List<string> Nganhs = new List<string>
	{
		"Nganh 1","Nganh 2","Nganh 3","Nganh 4"
	};
}
