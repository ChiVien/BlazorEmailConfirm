@page "/sinhvienss"
@using Microsoft.AspNetCore.Authorization;
@using Microsoft.AspNetCore.Identity;
@using Microsoft.AspNetCore.Components.Authorization
@using Microsoft.AspNetCore.Components.WebAssembly.Authentication
@inject HttpClient Http
@inject ISinhvientrungtuyen Sinhvientrungtuyen
@inject NavigationManager NavigationManager
@attribute [Authorize]
<h3>Sinh Viên</h3>

<table class="table">
	<thead>
		<tr>
			<td>Họ Tên</td>
            <td>Ngày Sinh</td>
            <td>Bậc Học</td>
            <td>Mã ngành xét tuyển</td>
            <td>Cán bộ tư vấn</td>
            <td>Trạng Thái</td>
            <td></td>
		</tr>
	</thead>
    <tbody>
        @foreach (var thish in onethisinh)
       {
            <tr>
                <td>@thish.HoTen</td>
                <td>@thish.NgaySinh</td>
                <td>@thish.BacHoc</td>
                <td>@thish.MaNganhXetTuyen</td>
                <td>@thish.CBTuVan</td>
                <td>@thish.TrangThai</td>
                <td>
                    <button class="btn btn-outline-warning" @onclick="(()=>showthish(thish.Id))"><i class="oi oi-pencil"></i></button>
                    @*<button class="btn btn-primary" @onclick="Createthish"><i class="oi oi-plus"></i></button>*@
                </td>
            </tr>           
       }
       <tfoot>
        <Pagination TotalPages="@(totalPages != 0 ? totalPages : 1)"
                    PageIndex="@PageIndex"
                    Radius="3"
                    OnSelectedPage="@SelectedPage">
        </Pagination>
    </tfoot>
    </tbody>
    <br />
  <button class="btn btn-outline-success" @onclick="Createthish">Create Sinh Viên</button>
</table>
@code {

    private IEnumerable<ThiSinh> onethisinh = Enumerable.Empty<ThiSinh>();

    private int PageIndex = 1;
    private int itemsPerPage = 5;
    private int totalPages = 1;

    protected override async Task OnInitializedAsync()
    {
        await Sinhvientrungtuyen.Getthisinh();
        if (Sinhvientrungtuyen != null)
        {
            // Initialize the number of "totalPages"


            // Initialize the "comments" which will be displayed when the page loaded first time.
            onethisinh = Sinhvientrungtuyen.thisinhs.ToList();
            totalPages = (int)Math.Ceiling((onethisinh.Count() / (decimal)itemsPerPage));
            onethisinh = Sinhvientrungtuyen.thisinhs.ToList().Skip(0).Take(itemsPerPage);
            Console.WriteLine(totalPages);
        }
        
    }
    void showthish(int id)
    {
        NavigationManager.NavigateTo($"thisinh/{id}");
    }
     void Createthish()
    {
        NavigationManager.NavigateTo("/thisinh");
    }
    private void SelectedPage(int selectedPageIndex)
    {
        if (Sinhvientrungtuyen != null)
        {
            PageIndex = selectedPageIndex;
            var skipCount = itemsPerPage * (PageIndex - 1);
            onethisinh = Sinhvientrungtuyen.thisinhs.ToList().Skip(skipCount).Take(itemsPerPage).ToList();
        }
    }
}
